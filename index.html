<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>random cat gallery</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* apply the lexend font to the body */
        body {
            font-family: 'Lexend', sans-serif;
            transition: color 0.3s ease;
            position: relative;
            overflow: hidden;
            /* New: Added perspective for 3D effect */
            perspective: 1000px;
        }

        /* dark mode background using the specific image */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url('https://512pixels.net/wp-content/uploads/2025/06/26-Tahoe-Dark-6K-thumb.jpeg');
            background-size: cover; /* this crops and scales the image to always fill the screen */
            background-position: center; /* centers the image */
            background-attachment: fixed; /* keeps the background in place while scrolling */
            z-index: -1;
        }

        /* Default theme (Dark) with a little transparency for the frosted glass effect */
        body {
            background-color: transparent;
            color: #d1d5db; /* gray-300 */
        }
        /* removed the bg-primary class, now ui elements are transparent */
        .bg-primary { background-color: transparent; } 
        .text-primary { color: #d1d5db; /* gray-300 */ }
        .bg-secondary { background-color: rgba(55, 65, 81, 0.8); }
        .text-secondary { color: #f3f4f6; /* gray-100 */ }
        
        /* Light theme overrides */
        body.light-theme {
            background-color: #f3f4f6; /* gray-100 */
            color: #1f2937; /* gray-800 */
        }
        body.light-theme .bg-primary { background-color: transparent; }
        body.light-theme .text-primary { color: #1f2937; /* gray-800 */ }
        body.light-theme .bg-secondary { background-color: #d1d5db; /* gray-300 */ }
        body.light-theme .text-secondary { color: #000000; /* black */ }
        body.light-theme .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }

        /* Light theme background using the specific image */
        body.light-theme::before {
            background-image: url('https://512pixels.net/wp-content/uploads/2025/06/26-Tahoe-Light-6K-thumb.jpeg');
        }

        /* Glassy effect for buttons */
        .glassy {
            background-color: rgba(255, 255, 255, 0.15); /* semi-transparent white */
            backdrop-filter: blur(10px); /* the key to the frosted glass look */
            border: 1px solid rgba(255, 255, 255, 0.2); /* subtle border */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            /* New: Added transitions for animation and 3D transforms */
            transition: box-shadow 0.2s ease, transform 0.2s ease, background-color 0.2s ease;
        }

        /* Glassy effect hover state with animation */
        .glassy:hover {
            background-color: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.4);
            transform: translateY(-2px); /* new: lifts the element on hover */
            box-shadow: 0 8px 12px rgba(0, 0, 0, 0.2); /* new: adds a more prominent shadow */
        }

        /* Glassy effect for light theme */
        body.light-theme .glassy {
            background-color: rgba(0, 0, 0, 0.05); /* semi-transparent black for light theme */
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        body.light-theme .glassy:hover {
            background-color: rgba(0, 0, 0, 0.1);
            border-color: rgba(0, 0, 0, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 8px 12px rgba(0, 0, 0, 0.1);
        }
        
        /* New styles to override default button backgrounds for glassy look */
        .glassy-button {
            background-color: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            /* New: Added transitions for animation */
            transition: box-shadow 0.2s ease, transform 0.2s ease, background-color 0.2s ease;
        }

        .glassy-button:hover {
            background-color: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.4);
            transform: translateY(-2px); /* new: lifts the button on hover */
            box-shadow: 0 8px 12px rgba(0, 0, 0, 0.2); /* new: adds a more prominent shadow */
        }

        /* Light theme glassy button */
        body.light-theme .glassy-button {
            background-color: rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        body.light-theme .glassy-button:hover {
            background-color: rgba(0, 0, 0, 0.1);
            border-color: rgba(0, 0, 0, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 8px 12px rgba(0, 0, 0, 0.1);
        }

        /* style for the button container */
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        /* Thumbnail grid styles */
        .thumbnail-grid {
            display: grid;
            /* Explicitly set for a 3-column layout on larger screens */
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem; /* Adjusted the gap for better spacing */
            width: 100%;
            height: 100%;
            /* Removed overflow-y: auto to prevent scrollbars */
            overflow: hidden;
            padding: 1.5rem; /* Adjusted padding for better fit */
        }

        /* Responsive adjustments for the grid */
        @media (max-width: 768px) {
             .thumbnail-grid {
                /* On smaller screens, allow the grid to adapt to the screen width */
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 1rem;
                padding: 1rem;
            }
        }
        
        /* Individual thumbnail card */
        .thumbnail-card {
            aspect-ratio: 1 / 1;
            cursor: pointer;
            overflow: hidden;
            border-radius: 1rem;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            position: relative; /* needed for positioning the like button */
        }

        .thumbnail-card:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 20px rgba(0, 0, 0, 0.3);
        }
        
        .thumbnail-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Like button styles */
        .like-button {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: rgba(0, 0, 0, 0.5);
            border: none;
            border-radius: 9999px; /* Tailwind's rounded-full */
            width: 2.5rem;
            height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            cursor: pointer;
            z-index: 10;
            transition: background-color 0.2s ease, transform 0.2s ease;
        }

        .like-button:hover {
            background-color: rgba(0, 0, 0, 0.7);
            transform: scale(1.1);
        }

        .like-button.liked {
            color: #ec4899; /* Tailwind's pink-500 */
        }
        
        /* Modal overlay styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.2); /* more transparent overlay */
            backdrop-filter: blur(10px); /* the new blur effect */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100; /* Increased z-index to ensure it's always on top */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s;
        }
        
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        
        /* new styles for smaller modal windows */
        .small-modal-content {
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 1.5rem;
            border-radius: 1.5rem;
            display: flex;
            flex-direction: column;
            position: relative;
            transform: scale(0.95);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .modal-overlay.show .small-modal-content {
            transform: scale(1);
            opacity: 1;
        }
        
        /* remove conflicting backgrounds from the modals */
        body.light-theme .small-modal-content,
        body:not(.light-theme) .small-modal-content {
            background-color: transparent;
        }
        
        /* NEW: Styles for the close button to make it more visible */
        .modal-close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background-color: rgba(0, 0, 0, 0.3); /* dark semi-transparent background */
            backdrop-filter: blur(5px); /* blur the area behind the button */
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 9999px; /* makes it a circle */
            width: 2.5rem; /* give it a fixed size */
            height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem; /* a little smaller to fit the circle */
            font-weight: bold;
            color: #ffffff; /* pure white for contrast */
            cursor: pointer;
            transition: all 0.2s ease;
            z-index: 10;
        }

        .modal-close-btn:hover {
            background-color: rgba(0, 0, 0, 0.5); /* darken on hover */
            transform: scale(1.1); /* subtle grow effect */
        }
        
        .modal-image {
            max-width: 100%;
            max-height: 70vh;
            object-fit: contain;
            border-radius: 1rem;
        }

        /* corrected liked-count styles to fit the button better */
        .liked-count {
            position: absolute;
            top: -0.5rem;
            right: -0.5rem;
            background-color: #ec4899;
            color: white;
            min-width: 1.5rem; /* ensures a minimum size for single-digit numbers */
            height: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
            padding: 0.1rem 0.3rem;
            border-radius: 9999px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); /* adds a subtle shadow */
        }

        /* NEW: Scrollbar styling for Webkit browsers (Chrome, Safari, etc.) */
        body::-webkit-scrollbar,
        .small-modal-content::-webkit-scrollbar {
            width: 10px;
        }

        body::-webkit-scrollbar-track,
        .small-modal-content::-webkit-scrollbar-track {
            background: transparent; /* a transparent track blends better */
        }

        body::-webkit-scrollbar-thumb,
        .small-modal-content::-webkit-scrollbar-thumb {
            background-color: rgba(255, 255, 255, 0.2); /* light gray thumb */
            border-radius: 5px; /* rounded corners for a smoother look */
            border: 2px solid transparent; /* a small transparent border to create spacing */
            background-clip: padding-box; /* ensures the border doesn't fill the thumb */
            transition: background-color 0.2s ease;
        }

        body::-webkit-scrollbar-thumb:hover,
        .small-modal-content::-webkit-scrollbar-thumb:hover {
            background-color: rgba(255, 255, 255, 0.4); /* a bit brighter on hover */
        }
        
        /* NEW: Scrollbar styling for Firefox */
        body,
        .small-modal-content {
            scrollbar-width: thin; /* a smoother, thinner bar */
            scrollbar-color: rgba(255, 255, 255, 0.2) transparent; /* thumb color and track color */
        }

        /* NEW: Light theme scrollbar styles */
        body.light-theme::-webkit-scrollbar-thumb,
        body.light-theme .small-modal-content::-webkit-scrollbar-thumb {
            background-color: rgba(0, 0, 0, 0.2);
        }

        body.light-theme::-webkit-scrollbar-thumb:hover,
        body.light-theme .small-modal-content::-webkit-scrollbar-thumb:hover {
            background-color: rgba(0, 0, 0, 0.4);
        }
        
        body.light-theme,
        body.light-theme .small-modal-content {
            scrollbar-color: rgba(0, 0, 0, 0.2) transparent;
        }

    </style>
</head>
<body class="text-gray-300 h-screen flex flex-col md:flex-row p-8">

    <!-- sidebar -->
    <aside id="sidebar" class="md:w-1/5 lg:w-1/6 glassy py-6 px-8 mb-4 md:mb-0 md:mr-4 flex flex-col justify-between rounded-2xl">
        <!-- refresh and back buttons -->
        <div class="flex items-center justify-center gap-2 mb-4">
            <!-- onmouseover added to play sound -->
            <button id="loadPreviousBtn" onmouseover="playHoverSound()" onclick="loadPreviousGallery()" class="w-12 h-12 glassy text-primary text-xl rounded-full shadow-lg transition-colors duration-200 focus:outline-none focus:ring-4 focus:ring-gray-500 focus:ring-opacity-50 disabled:bg-gray-700 disabled:text-gray-400 disabled:cursor-not-allowed" aria-label="load previous gallery" title="Load Previous Gallery" disabled>
                &#x21ba;
            </button>
            <div class="relative">
                <!-- onmouseover added to play sound -->
                <button id="showLikedCatsBtn" onmouseover="playHoverSound()" onclick="showLikedCats()" class="w-12 h-12 glassy text-primary text-xl rounded-full shadow-lg transition-colors duration-200 focus:outline-none focus:ring-4 focus:ring-gray-500 focus:ring-opacity-50" aria-label="show liked cats" title="Show Liked Cats">
                    &#x2605;
                </button>
                <span id="liked-count" class="liked-count">0</span>
            </div>
            <!-- onmouseover added to play sound -->
            <button onmouseover="playHoverSound()" onclick="getNewCats()" class="w-12 h-12 bg-indigo-600 text-white text-xl rounded-full shadow-lg hover:bg-indigo-700 transition-colors duration-200 focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50" aria-label="generate new gallery" title="Generate New Gallery">
                &#x21bb;
            </button>
        </div>

        <!-- Theme switcher -->
        <div>
            <hr class="my-6 border-gray-600 light-theme:border-gray-400">
            <h3 class="text-xl font-bold mb-4 text-center text-primary">theme</h3>
            <div class="flex justify-center gap-4">
                <!-- onmouseover added to play sound -->
                <button id="lightThemeBtn" onmouseover="playHoverSound()" onclick="setTheme('light')" class="px-4 py-2 rounded-full border border-gray-600 light-theme:border-gray-400 glassy-button text-primary">light</button>
                <!-- onmouseover added to play sound -->
                <button id="darkThemeBtn" onmouseover="playHoverSound()" onclick="setTheme('dark')" class="px-4 py-2 rounded-full border border-gray-600 light-theme:border-gray-400 glassy-button text-primary">dark</button>
            </div>
        </div>

        <!-- new liked actions section -->
        <div>
            <hr class="my-6 border-gray-600 light-theme:border-gray-400">
            <h3 class="text-xl font-bold mb-4 text-center text-primary">liked cats</h3>
            <div class="flex justify-center">
                <!-- onmouseover added to play sound -->
                <button onmouseover="playHoverSound()" onclick="clearLikedCats()" class="px-4 py-2 rounded-full glassy-button text-red-500">clear all</button>
            </div>
        </div>

        <!-- new about section -->
        <div>
            <hr class="my-6 border-gray-600 light-theme:border-gray-400">
            <h3 class="text-xl font-bold mb-4 text-center text-primary">about</h3>
            <div class="flex justify-center">
                <!-- onmouseover added to play sound -->
                <button onmouseover="playHoverSound()" onclick="showAboutModal()" class="px-4 py-2 rounded-full glassy-button text-primary">info</button>
            </div>
        </div>
    </aside>

    <!-- main content area for the gallery -->
    <main id="main-content" class="flex-1 glassy overflow-hidden flex flex-col items-center justify-center relative rounded-2xl">
        <div id="cat-gallery" class="thumbnail-grid">
            <!-- cat thumbnails will be dynamically inserted here -->
        </div>
        
        <!-- custom message box for loading/sharing -->
        <div id="messageBox" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 glassy text-white p-6 rounded-lg shadow-lg z-110 transform scale-0 transition-transform duration-300">
            <p id="messageText" class="text-lg"></p>
            <!-- onmouseover added to play sound -->
            <button onmouseover="playHoverSound()" onclick="hideMessage()" class="mt-4 w-full px-4 py-2 bg-indigo-600 rounded-full hover:bg-indigo-700">ok</button>
        </div>
    </main>
    
    <!-- Modal for displaying a large cat -->
    <div id="catModal" class="modal-overlay">
        <div class="small-modal-content glassy rounded-2xl">
            <!-- onmouseover added to play sound -->
            <button onmouseover="playHoverSound()" onclick="closeModal('catModal')" class="modal-close-btn text-primary light-theme:text-gray-800">&times;</button>
            <img id="modal-image" class="modal-image rounded-xl" src="" alt="large view of a cat">
            <div class="flex justify-center gap-4 mt-4">
                <!-- onmouseover added to play sound -->
                <button onmouseover="playHoverSound()" onclick="downloadCat()" class="px-6 py-4 bg-blue-600 text-white font-bold rounded-xl shadow-lg hover:bg-blue-700 transition-colors duration-200 focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50">
                    download
                </button>
                <!-- onmouseover added to play sound -->
                <button onmouseover="playHoverSound()" onclick="shareCat()" class="px-6 py-4 bg-teal-600 text-white font-bold rounded-xl shadow-lg hover:bg-teal-700 transition-colors duration-200 focus:outline-none focus:ring-4 focus:ring-teal-500 focus:ring-opacity-50">
                    share
                </button>
            </div>
        </div>
    </div>

    <!-- Modal for displaying liked cats -->
    <div id="likedCatsModal" class="modal-overlay">
        <div class="small-modal-content glassy !p-0 rounded-2xl">
            <!-- onmouseover added to play sound -->
            <button onmouseover="playHoverSound()" onclick="closeModal('likedCatsModal')" class="modal-close-btn">&times;</button>
            <h2 class="text-2xl font-bold p-6 text-indigo-500">your liked cats</h2>
            <div id="liked-cats-gallery" class="thumbnail-grid">
                <!-- liked cat thumbnails will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <!-- new about modal -->
    <div id="aboutModal" class="modal-overlay">
        <div class="small-modal-content glassy !p-6 rounded-2xl">
            <!-- onmouseover added to play sound -->
            <button onmouseover="playHoverSound()" onclick="closeModal('aboutModal')" class="modal-close-btn text-primary light-theme:text-gray-800">&times;</button>
            <h2 class="text-2xl font-bold mb-4 text-indigo-500">about this app</h2>
            <p class="text-lg text-primary light-theme:text-gray-700">
                this app fetches random cat images from the
                <a href="https://thecatapi.com/" target="_blank" class="text-indigo-400 hover:underline">the cat api</a>.
                the fetching mechanic was made by me, but not the ui, it was made by gemini, because i do not know SHIT about ui
            </p>
        </div>
    </div>

    <!-- The audio element for the hover sound -->
    <audio id="hover-sound" src="https://cdn.pixabay.com/audio/2022/01/24/audio_34d19339a1.mp3" preload="auto"></audio>
    
    <script>
        let audioEnabled = false;

        // Start pre-fetching the first image on load
        window.onload = function() {
            loadLikedCats(); // load liked cats from local storage on page load
            loadTheme(); // load the user's preferred theme
            preloadGallery();
        };

        // new javascript for the 3d mouse effect
        document.body.addEventListener('mousemove', (e) => {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('main-content');
            
            const { clientX, clientY } = e;
            const { innerWidth, innerHeight } = window;
            
            // Calculate mouse position relative to the center of the screen
            const x = (clientX / innerWidth) - 0.5;
            const y = (clientY / innerHeight) - 0.5;
            
            // Calculate rotation angles, with a small scaling factor for subtlety
            const rotateX = y * 10;
            const rotateY = -x * 10;
            
            // Apply the transform to the main containers
            sidebar.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
            mainContent.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
        });
        
        // new listener to reset the transform when the mouse leaves the page
        document.body.addEventListener('mouseleave', () => {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('main-content');
            
            sidebar.style.transform = 'rotateX(0deg) rotateY(0deg)';
            mainContent.style.transform = 'rotateX(0deg) rotateY(0deg)';
        });

        // --- THE AUDIO FIX ---
        // Listen for a user interaction to enable audio playback
        // We use a flag to make sure this only happens once
        document.addEventListener('click', () => {
            if (!audioEnabled) {
                // we check if the audio context exists and if not, we create it
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                if (audioContext.state === 'suspended') {
                    audioContext.resume().then(() => {
                        console.log("Audio context resumed successfully.");
                    }).catch(err => {
                        console.error("Error resuming audio context:", err);
                    });
                }
                audioEnabled = true;
                console.log("Audio is now enabled due to user interaction.");
            }
        }, { once: true });
        // --- END AUDIO FIX ---

        // UI functionality
        const maxCats = 6;
        let previousCats = [];
        let likedCats = [];

        // --- theme functions ---
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            setTheme(savedTheme);
        }

        function setTheme(theme) {
            const body = document.body;
            if (theme === 'light') {
                body.classList.add('light-theme');
                localStorage.setItem('theme', 'light');
            } else {
                body.classList.remove('light-theme');
                localStorage.setItem('theme', 'dark');
            }
        }
        // --- end theme functions ---

        // NEW: function to play the hover sound effect
        function playHoverSound() {
            // Only play the sound if the audio has been enabled by user interaction
            if (audioEnabled) {
                const sound = document.getElementById('hover-sound');
                if (sound) {
                    // reset the sound to the beginning for quick hovers
                    sound.currentTime = 0; 
                    sound.play().catch(error => console.error("Playback failed:", error));
                }
            } else {
                console.log("Audio playback is not yet enabled. Click anywhere on the page to enable it.");
            }
        }

        // function to save the liked cats to local storage
        function saveLikedCats() {
            localStorage.setItem('likedCats', JSON.stringify(likedCats));
        }

        // function to load the liked cats from local storage
        function loadLikedCats() {
            const savedCats = localStorage.getItem('likedCats');
            if (savedCats) {
                likedCats = JSON.parse(savedCats);
            }
            updateLikedCount();
        }

        // function to pre-load a full gallery of unique cats
        async function preloadGallery() {
            showMessage("preloading the cat gallery...");
            try {
                saveCurrentGallery();

                const gallery = document.getElementById('cat-gallery');
                gallery.innerHTML = '';

                const response = await fetch(`https://api.thecatapi.com/v1/images/search?limit=${maxCats}`);
                if (!response.ok) {
                    throw new Error('failed to fetch images from the cat api');
                }
                const data = await response.json();
                
                if (data && data.length > 0) {
                    data.forEach(image => {
                        addCatThumbnail(image.url, gallery);
                    });
                } else {
                    throw new Error('invalid data format from the cat api');
                }
                
                hideMessage();
            } catch (error) {
                console.error(error);
                showMessage("sorry, something went wrong while preloading. please try again.");
            }
            updateLikedCount();
        }

        // function to save the current gallery to the previousCats array
        function saveCurrentGallery() {
            const gallery = document.getElementById('cat-gallery');
            const currentCatUrls = Array.from(gallery.children).map(card => card.querySelector('img').src);
            if (currentCatUrls.length > 0) {
                previousCats = currentCatUrls;
                setPreviousGalleryButtonState(true);
            }
        }
        
        // function to add a new thumbnail to the gallery
        function addCatThumbnail(url, parentElement) {
            const card = document.createElement('div');
            card.className = 'thumbnail-card';
            card.onclick = (e) => showLargeCat(url);
            
            const img = document.createElement('img');
            img.className = 'thumbnail-image';
            img.src = url;
            img.alt = 'a cat thumbnail';
            
            const likeButton = document.createElement('button');
            likeButton.className = 'like-button';
            likeButton.innerHTML = '&#x2764;';
            
            if (likedCats.includes(url)) {
                likeButton.classList.add('liked');
            }

            likeButton.onclick = (e) => {
                e.stopPropagation(); 
                
                const isLiked = likedCats.includes(url);
                if (isLiked) {
                    // Unlike the cat
                    const index = likedCats.indexOf(url);
                    if (index > -1) {
                        likedCats.splice(index, 1);
                    }
                    likeButton.classList.remove('liked');
                } else {
                    // Like the cat
                    likedCats.push(url);
                    likeButton.classList.add('liked');
                }
                updateLikedCount();
                saveLikedCats(); // save the updated list to local storage
            };

            card.appendChild(img);
            card.appendChild(likeButton);
            
            if (parentElement.id === 'cat-gallery' && parentElement.children.length >= maxCats) {
                parentElement.removeChild(parentElement.firstChild);
            }
            
            parentElement.appendChild(card);
        }

        // function to update the gallery with a new set of cats
        async function getNewCats() {
            saveCurrentGallery();
            preloadGallery();
        }

        // function to load the previous gallery
        function loadPreviousGallery() {
            if (previousCats.length === 0) return;

            const gallery = document.getElementById('cat-gallery');
            gallery.innerHTML = '';
            
            previousCats.forEach(url => {
                addCatThumbnail(url, gallery);
            });

            previousCats = [];
            setPreviousGalleryButtonState(false);
            updateLikedCount(); // also update the count when loading a new gallery
        }

        // helper function to manage the disabled state of the back button
        function setPreviousGalleryButtonState(enabled) {
            const button = document.getElementById('loadPreviousBtn');
            button.disabled = !enabled;
        }

        // function to display the liked cats
        function showLikedCats() {
            closeAllModals(); // close all modals first
            const likedCatsModal = document.getElementById('likedCatsModal');
            const gallery = document.getElementById('liked-cats-gallery');
            gallery.innerHTML = '';

            if (likedCats.length === 0) {
                gallery.innerHTML = '<p class="text-lg text-gray-500 p-8">you haven\'t liked any cats yet!</p>';
            } else {
                likedCats.forEach(url => {
                    const card = document.createElement('div');
                    card.className = 'thumbnail-card';
                    card.onclick = (e) => showLargeCat(url);
                    
                    const img = document.createElement('img');
                    img.className = 'thumbnail-image';
                    img.src = url;
                    img.alt = 'a liked cat thumbnail';
                    
                    card.appendChild(img);
                    gallery.appendChild(card);
                });
            }
            likedCatsModal.classList.add('show');
        }

        // function to clear all liked cats
        function clearLikedCats() {
            if (likedCats.length === 0) {
                showMessage("there are no liked cats to clear!");
                return;
            }
            
            likedCats = [];
            saveLikedCats();
            updateLikedCount();
            
            // Find all like buttons and remove the 'liked' class
            const allLikeButtons = document.querySelectorAll('.like-button');
            allLikeButtons.forEach(button => button.classList.remove('liked'));
            
            showMessage("all liked cats have been cleared!");
            
            // Also ensure the liked cats modal is empty if it was open
            const likedCatsModal = document.getElementById('likedCatsModal');
            if (likedCatsModal.classList.contains('show')) {
                document.getElementById('liked-cats-gallery').innerHTML = '<p class="text-lg text-gray-500 p-8">you haven\'t liked any cats yet!</p>';
            }
        }

        // functions for the modal
        function showLargeCat(url) {
            closeAllModals(); // close all modals first
            const modal = document.getElementById('catModal');
            const modalImage = document.getElementById('modal-image');
            modalImage.src = url;
            modal.classList.add('show');
        }

        function showAboutModal() {
            closeAllModals();
            const modal = document.getElementById('aboutModal');
            modal.classList.add('show');
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('show');
        }

        // helper function to close all modals
        function closeAllModals() {
            closeModal('catModal');
            closeModal('likedCatsModal');
            closeModal('aboutModal');
        }

        // function to download the image from the modal
        async function downloadCat() {
            try {
                const imgElement = document.getElementById('modal-image');
                const imgUrl = imgElement.src;

                // Use fetch to get the image as a Blob
                const response = await fetch(imgUrl);
                if (!response.ok) {
                    throw new Error('failed to fetch image for download');
                }
                const blob = await response.blob();

                // Create a temporary URL for the blob
                const tempUrl = URL.createObjectURL(blob);

                // Create a download link
                const link = document.createElement('a');
                link.href = tempUrl;
                link.download = 'random-cat.jpg';
                document.body.appendChild(link);

                // Trigger the download
                link.click();

                // Clean up the temporary URL and link element
                document.body.removeChild(link);
                URL.revokeObjectURL(tempUrl);
            } catch (error) {
                console.error("error during download:", error);
                showMessage("sorry, the download failed. please try again.");
            }
        }

        // a function to share the image url.
        function shareCat() {
            const imgElement = document.getElementById('modal-image');
            const imgUrl = imgElement.src;
            if (navigator.share) {
                navigator.share({
                    title: 'check out this cute cat!',
                    url: imgUrl
                }).then(() => {
                    console.log('thanks for sharing!');
                }).catch(console.error);
            } else {
                const el = document.createElement('textarea');
                el.value = imgUrl;
                document.body.appendChild(el);
                el.select();
                document.execCommand('copy');
                document.body.removeChild(el);
                showMessage('image url copied to clipboard!');
            }
        }
        
        // functions for the custom message box
        function showMessage(text) {
            const messageBox = document.getElementById('messageBox');
            const messageText = document.getElementById('messageText');
            messageText.textContent = text;
            messageBox.style.transform = 'translate(-50%, -50%) scale(1)';
        }

        function hideMessage() {
            const messageBox = document.getElementById('messageBox');
            messageBox.style.transform = 'translate(-50%, -50%) scale(0)';
        }

        function updateLikedCount() {
            document.getElementById('liked-count').textContent = likedCats.length;
        }
    </script>
</body>
</html>
